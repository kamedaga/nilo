// å‹•çš„Foreachå°‚ç”¨ãƒ†ã‚¹ãƒˆ - ãƒªã‚¹ãƒˆæ“ä½œã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
flow {
    start: DynamicForeachTest
}

timeline DynamicForeachTest {
    font: "japanese"
    
    VStack(style: {
        width: 100ww, 
        height: 100wh, 
        background: "#0a0e27", 
        padding: 20,
        gap: 16px
    }) {
        // ãƒ˜ãƒƒãƒ€ãƒ¼
        VStack(style: {width: 100%, padding: [20, 0]}) {
            Text("ğŸ”„ Dynamic Foreach Test", style: {
                font_size: 32px, 
                color: "#00ff88"
            })
            Text("ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…åˆ—æ“ä½œã¨foreachè‡ªå‹•æ›´æ–°", style: {
                font_size: 16px, 
                color: "#88ffbb"
            })
        }
        
        // æ“ä½œãƒ‘ãƒãƒ«
        VStack(style: {
            background: "#1a1a2e",
            padding: 20,
            rounded: 12px,
            border_color: "#00ff88"
        }) {
            Text("ğŸ“‹ ãƒªã‚¹ãƒˆæ“ä½œ", style: {
                font_size: 20px,
                color: "#00ff88",
                padding: [0, 0, 12, 0]
            })
            
            HStack(style: {gap: 12px}) {
                Button(id: add_item, label: "è¦ç´ è¿½åŠ ", style: {
                    background: "#00aa55",
                    color: "#ffffff",
                    padding: [8, 16],
                    rounded: 6px
                })
                
                Button(id: remove_item, label: "è¦ç´ å‰Šé™¤", style: {
                    background: "#aa5500",
                    color: "#ffffff", 
                    padding: [8, 16],
                    rounded: 6px
                })
                
                Button(id: clear_list, label: "å…¨å‰Šé™¤", style: {
                    background: "#aa0000",
                    color: "#ffffff",
                    padding: [8, 16],
                    rounded: 6px
                })
            }
            
            Text("ç¾åœ¨ã®è¦ç´ æ•°: {}", state.items.length, style: {
                font_size: 16px,
                color: "#ffffff",
                padding: [8, 0, 0, 0]
            })
        }
        
        // å‹•çš„é…åˆ—ã®è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³
        VStack(style: {
            background: "#16213e",
            padding: 20,
            rounded: 12px,
            border_color: "#4466ff"
        }) {
            Text("ğŸ“ é…åˆ—å†…å®¹ (foreachè‡ªå‹•æ›´æ–°)", style: {
                font_size: 20px,
                color: "#4466ff",
                padding: [0, 0, 12, 0]
            })
            
            Text("Rawé…åˆ—: {}", state.items, style: {
                font_size: 14px,
                color: "#ffff44"
            })
            
            dynamic_section list_display() {
                VStack(style: {width: 100%, gap: 6px, padding: [10, 0]}) {
                    foreach item in state.items {
                        HStack(style: {
                            background: "#223366", 
                            padding: [8, 12], 
                            rounded: 8px,
                            gap: 12px
                        }) {
                            Text("Item:", style: {
                                color: "#88ccff",
                                font_size: 14px
                            })
                            Text("{}", item, style: {
                                color: "#ffffff", 
                                font_size: 16px,
                                font_weight: "bold"
                            })
                            Text("(Index: {})", item_index, style: {
                                color: "#aaaaaa",
                                font_size: 12px
                            })
                        }
                    }
                }
            }
        }
        
        // çµ±è¨ˆæƒ…å ±
        VStack(style: {
            background: "#2e1a3e", 
            padding: 20,
            rounded: 12px,
            border_color: "#aa66ff"
        }) {
            Text("ğŸ“Š çµ±è¨ˆ", style: {
                font_size: 20px,
                color: "#aa66ff",
                padding: [0, 0, 12, 0]
            })
            
            dynamic_section stats() {
                VStack(style: {gap: 8px}) {
                    HStack(style: {gap: 20px}) {
                        Text("ç·è¦ç´ æ•°: {}", state.items.length, style: {
                            color: "#ffffff",
                            font_size: 16px
                        })
                        Text("æ¬¡ã®å€¤: {}", state.next_item_value, style: {
                            color: "#cccccc", 
                            font_size: 14px
                        })
                    }
                    
                    if state.items.length > 0 {
                        VStack(style: {gap: 4px, padding: [8, 0]}) {
                            Text("Foreachå‡¦ç†çŠ¶æ³:", style: {
                                color: "#aa66ff",
                                font_size: 14px
                            })
                            foreach item in state.items {
                                Text("âœ“ Processing: {}", item, style: {
                                    color: "#44ff44",
                                    font_size: 12px,
                                    padding: [2, 16]
                                })
                            }
                        }
                    } else {
                        Text("(é…åˆ—ãŒç©ºã§ã™)", style: {
                            color: "#888888",
                            font_style: "italic"
                        })
                    }
                }
            }
        }
        
        // ãƒ•ãƒƒã‚¿ãƒ¼
        VStack(style: {
            background: "#0f1419",
            padding: 16,
            rounded: 8px,
            border_color: "#374151"
        }) {
            Text("Dynamic Foreach Test - é…åˆ—æ“ä½œã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°", style: {
                font_size: 14px,
                color: "#9ca3af"
            })
        }
    }
    
    // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
    when user.click(add_item) {
        append(state.items, state.next_item_value)
        set state.next_item_value = state.next_item_value + 1
    }

    when user.click(remove_item) {
        if state.items.length > 0 {
            remove(state.items, 0)  // æœ€åˆã®è¦ç´ ã‚’å‰Šé™¤
        }
    }

    when user.click(clear_list) {
        clear(state.items)
        set state.next_item_value = 1  // ãƒªã‚»ãƒƒãƒˆ
    }
}